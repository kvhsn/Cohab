generator client {
    provider = "prisma-client-js"
    output   = "../src/generated/prisma"
}

datasource db {
    provider = "postgresql"
}

model User {
    id        String   @id @default(cuid())
    email     String   @unique
    password  String
    name      String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    houseHoldId           String?
    houseHold             HouseHold? @relation("HouseHold_members", fields: [houseHoldId], references: [id])
    administeredHouseHold HouseHold? @relation("HouseHold_admin")

    expenses Expense[] @relation("Member_expense")

    @@unique([id, houseHoldId]) // Prevent a user from being in multiple households
}

model HouseHold {
    id        String   @id @default(cuid())
    name      String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    adminId String @unique
    members User[] @relation("HouseHold_members")
    admin   User   @relation("HouseHold_admin", fields: [adminId], references: [id])

    invitation Invitation? @relation("HouseHold_invitation")
    Expenses   Expense[]   @relation("HouseHold_expense")
}

model Invitation {
    id          String    @id @default(cuid())
    householdId String    @unique
    createdAt   DateTime  @default(now())
    code        String    @unique
    household   HouseHold @relation("HouseHold_invitation", fields: [householdId], references: [id])
}

model Expense {
    id          String    @id @default(cuid())
    name        String
    amount      Float
    houseHoldId String
    household   HouseHold @relation("HouseHold_expense", fields: [houseHoldId], references: [id])
    memberId    String
    member      User      @relation("Member_expense", fields: [memberId], references: [id])

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}
